<html>
  <head>
    <meta charset="utf-8" />
<meta name="description" content="" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Netatalk v3 安装 - deepin | Aidan&#39;s Blog</title>
<link rel="shortcut icon" href="https://aidanwangcy.github.io/favicon.ico?v=1578015868220">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://aidanwangcy.github.io/styles/main.css">

<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
<script src="https://cdn.bootcss.com/moment.js/2.23.0/moment.min.js"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=UA-142106965-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-142106965-1');
</script>


  </head>
  <body>
    <div class="main">
      <div class="main-content">
        <div class="site-header">
  <a href="https://aidanwangcy.github.io">
  <img class="avatar" src="https://aidanwangcy.github.io/images/avatar.png?v=1578015868220" alt="">
  </a>
  <h1 class="site-title">
    Aidan&#39;s Blog
  </h1>
  <p class="site-description">
    Pain is motivation.
  </p>
  <div class="menu-container">
    
      
        <a href="/" class="menu">
          首页
        </a>
      
    
      
        <a href="/archives" class="menu">
          归档
        </a>
      
    
      
        <a href="/tags" class="menu">
          标签
        </a>
      
    
      
        <a href="/post/about" class="menu">
          关于
        </a>
      
    
  </div>
  <div class="social-container">
    
      
        <a href="https://github.com/Aidanwangcy" target="_blank">
          <i class="fab fa-github"></i>
        </a>
      
    
      
        <a href="https://twitter.com/Aidanwang6" target="_blank">
          <i class="fab fa-twitter"></i>
        </a>
      
    
      
    
      
    
      
    
  </div>
</div>


        <div class="post-detail">
          <article class="post">
            <h2 class="post-title">
              Netatalk v3 安装 - deepin
            </h2>
            <div class="post-info">
              <time class="post-time">
                · 2019-07-08 ·
              </time>
              
            </div>
            
            <div class="post-content">
              <p>直接用apt安装安装的是netatalk v2版本<br>
所以使用官网安装方法安装v3版本</p>
<!-- more -->
<p>所以使用官网安装方法<br>
http://netatalk.sourceforge.net/wiki/index.php/Install_Netatalk_3.1.12_on_Debian_9_Stretch</p>
<p>居然不提供依赖包的命令行</p>
<h1 id="1依赖包">1.依赖包：</h1>
<pre><code>sudo apt install build-essential libevent-dev libssl-dev libgcrypt-dev libkrb5-dev libpam0g-dev libwrap0-dev libdb-dev libtdb-dev libmariadbclient-dev avahi-daemon libavahi-client-dev libacl1-dev libldap2-dev libcrack2-dev systemtap-sdt-dev libdbus-1-dev libdbus-glib-1-dev libglib2.0-dev libio-socket-inet6-perl tracker libtracker-sparql-1.0-dev libtracker-miner-1.0-dev
</code></pre>
<h1 id="2-下载netatalk源文件">2. <a href="https://sourceforge.net/projects/netatalk/files/netatalk/">下载</a>Netatalk源文件</h1>
<p>或使用 <code>wget http://prdownloads.sourceforge.net/netatalk/netatalk-3.1.12.tar.bz2</code></p>
<p>cd到下载文件目录</p>
<pre><code>tar xvf netatalk-3.1.12.tar.bz2
cd netatalk-3.1.12
</code></pre>
<h1 id="3开始安装配置">3.开始安装配置</h1>
<pre><code>./configure \
        --with-init-style=debian-systemd \
        --without-libevent \
        --without-tdb \
        --with-cracklib \
        --enable-krbV-uam \
        --with-pam-confdir=/etc/pam.d \
        --with-dbus-daemon=/usr/bin/dbus-daemon \
        --with-dbus-sysconf-dir=/etc/dbus-1/system.d \
        --with-tracker-pkgconfig-version=1.0
</code></pre>
<h1 id="3之后就可以make了">3.之后就可以make了</h1>
<p><strong>这里有个问题：如果在conda的环境里记得退出来<code>conda deactivate</code>，如果出现文件访问问题需要使用sudo权限</strong></p>
<pre><code>sudo make
</code></pre>
<pre><code>sudo make install
</code></pre>
<p>两步都不应该有错误</p>
<h1 id="4检查安装">4.检查安装：</h1>
<p>需要先把netatalk添加到PATH中</p>
<pre><code>export PATH=&quot;/usr/local/sbin/:$PATH&quot;
</code></pre>
<p>再使用<code>netatalk -V</code>和<code>afpd -V</code>可得到</p>
<pre><code>$ /usr/local/sbin/netatalk -V
netatalk 3.1.12 - Netatalk AFP server service controller daemon

This program is free software; you can redistribute it and/or modify it under
the terms of the GNU General Public License as published by the Free Software
Foundation; either version 2 of the License, or (at your option) any later
version. Please see the file COPYING for further information and details.

netatalk has been compiled with support for these features:

      Zeroconf support: Avahi
     Spotlight support: Yes

                  afpd: /usr/local/sbin/afpd
            cnid_metad: /usr/local/sbin/cnid_metad
       tracker manager: /usr/bin/tracker daemon
           dbus-daemon: /usr/bin/dbus-daemon
              afp.conf: /usr/local/etc/afp.conf
     dbus-session.conf: /usr/local/etc/dbus-session.conf
    netatalk lock file: /var/lock/netatalk
		
$ /usr/local/sbin/afpd -V
afpd 3.1.12 - Apple Filing Protocol (AFP) daemon of Netatalk

This program is free software; you can redistribute it and/or modify it under
the terms of the GNU General Public License as published by the Free Software
Foundation; either version 2 of the License, or (at your option) any later
version. Please see the file COPYING for further information and details.

afpd has been compiled with support for these features:

          AFP versions: 2.2 3.0 3.1 3.2 3.3 3.4 
         CNID backends: dbd last tdb mysql 
      Zeroconf support: Avahi
  TCP wrappers support: Yes
         Quota support: Yes
   Admin group support: Yes
    Valid shell checks: Yes
      cracklib support: Yes
            EA support: ad | sys
           ACL support: Yes
          LDAP support: Yes
         D-Bus support: Yes
     Spotlight support: Yes
         DTrace probes: Yes

              afp.conf: /usr/local/etc/afp.conf
           extmap.conf: /usr/local/etc/extmap.conf
       state directory: /usr/local/var/netatalk/
    afp_signature.conf: /usr/local/var/netatalk/afp_signature.conf
      afp_voluuid.conf: /usr/local/var/netatalk/afp_voluuid.conf
       UAM search path: /usr/local/lib/netatalk//
  Server messages path: /usr/local/var/netatalk/msg/
</code></pre>
<h1 id="5配置afpconf">5.配置afp.conf</h1>
<pre><code>[My Time Machine]
path = /mnt/timemachine/storage #确保路径可正常访问
time machine = yes
# vol size limit = 170000
spotlight = yes
</code></pre>
<p>使用下列命令启动</p>
<pre><code># systemctl enable avahi-daemon
# systemctl enable netatalk
# systemctl start avahi-daemon
# systemctl start netatalk
</code></pre>
<p>在<code>/etc/samba/smb.conf</code>中使用<br>
<code>hide files = /.DS_Store/Network TrashFolder/TheFindByContentFolder/TheVolumeSettingsFolder/TemporaryItems/.TemporaryItems/.VolumeIcon.icns/Icon?/.FBCIndex/.FBCLockFolder/</code>来隐藏不需要的文件</p>
<p>参考：</p>
<blockquote>
<p>https://www.orzorc.com/201611/implementation-of-afp-server-on-ubuntu/<br>
http://netatalk.sourceforge.net/wiki/index.php/Install_Netatalk_3.1.12_on_Debian_9_Stretch</p>
</blockquote>

            </div>
          </article>
        </div>

        
          <div class="next-post">
            <div class="next">下一篇</div>
            <a href="https://aidanwangcy.github.io/post/shi-yong-linux-da-jian-shi-jian-xiao-nang-time-machinefu-wu-qi">
              <h3 class="post-title">
                使用 Linux - deepin 搭建 Apple 时间机器（Time Machine）服务器
              </h3>
            </a>
          </div>
        

        
          
            <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>

<div id="gitalk-container"></div>

<script>

  var gitalk = new Gitalk({
    clientID: '36a0b20ccd06c3234ff4',
    clientSecret: 'cdec57f5b537c9390995636abc7ffdb0c17dd5bd',
    repo: 'Aidanwangcy.github.io',
    owner: 'Aidanwangcy',
    admin: ['Aidanwangcy'],
    id: (location.pathname).substring(0, 49),      // Ensure uniqueness and length less than 50
    distractionFreeMode: false  // Facebook-like distraction free mode
  })

  gitalk.render('gitalk-container')

</script>

          

          
        

        <div class="site-footer">
  Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | 
  <a class="rss" href="https://aidanwangcy.github.io/atom.xml" target="_blank">RSS</a>
</div>

<script>
  hljs.initHighlightingOnLoad()
</script>

      </div>
    </div>
  </body>
</html>
